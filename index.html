<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
    }
    .your-id {
      font-weight: bold;
      margin: 10px;
      font-size: 1.5rem;
    }
    .input {
      width: 60vw;
      min-height: 30px;
      padding: 10px;
      font-family: 'Courier New', Courier, monospace;
      outline: none;
      background: #e8e8e8;
      box-shadow: 5px 5px 17px #c8c8c8,
      -5px -5px 17px #ffffff;
      border: none;
      border-radius: 10px;
      transition: all .5s;
    }
    .input::placeholder {
      font-size: 20px;
    }
    .input:focus {
      background: #e8e8e8;
      box-shadow: inset 5px 5px 17px #c8c8c8,
      inset -5px -5px 17px #ffffff;
    }
    button {
      padding: 15px;
      margin: 15px;
      background-color: tan;
      font-weight: bold;
      color: white;
      font-size: 15px;
      border: none;
      border-radius: 10px;
      box-shadow: 0 0 10px 5px #c8c8c8;
    }
    .Your-video , .Friend-video {
      width: calc(100vw - 20px);
      border-radius: 10px;
      margin: 10px;
      border: 3px solid #775a5a;
      background-color: black;
    }
  </style>
</head>
<body>
  <div class="your-id" id="your-id">
    Your id : Loading..
  </div>
  <input id="fr-id" class="input" placeholder="friends id" />
<button id="btn" disabled>Call friend</button>

<span style="margin:10px; font-size:15px; font-weight:bold;">You </span>
<video id="yr-video" class="Your-video" autoplay muted></video>

<span style="margin:10px; font-size:15px; font-weight:bold;">Friend </span>
<video autoplay muted class="Friend-video" id="fr-video"></video>

<script>
  let frid, lcid, localStream;
  frid = document.getElementById("fr-id");
  const shower = document.getElementById("your-id");
  const localVideo = document.getElementById("yr-video");
  const remoteVideo = document.getElementById("fr-video");
  const connectBtn = document.getElementById("btn");

  const peer = new Peer();

  async function initializeWebcam() {
    try {
      localStream = await navigator.mediaDevices.getUserMedia({
        video: true, audio: true
      });
      localVideo.srcObject = localStream;
    } catch (error) {
      alert("Could not access your webcam or microphone. Please check your permissions.");
      console.error("Webcam error:", error);
    }
  }

  function handleClick() {
    if (!frid.value.trim()) {
      alert("Please enter your friend's ID!");
      return;
    }

    lcid = frid.value.trim();
    const call = peer.call(lcid, localStream);
    call.on("stream", (remoteStream) => {
      remoteVideo.srcObject = remoteStream;
    });
  }

  peer.on("call", (call) => {
    call.answer(localStream);
    call.on("stream", (remoteStream) => {
      remoteVideo.srcObject = remoteStream;
    });
  });

  peer.on("open", (id) => {
    connectBtn.disabled = false;
    lcid = id;
    shower.textContent = `Your id : ${id}`;
  });

  frid.addEventListener("input", () => {
    connectBtn.disabled = !frid.value.trim();
  });

  connectBtn.addEventListener("click", handleClick);

  // Initialize webcam on page load
  initializeWebcam();
</script>
</body>
</html>
